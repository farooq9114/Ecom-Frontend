<!-- =============================
     LOADING SPINNER
================================ -->
<ng-template #loading>
    <div class="text-center mt-5">
        <div class="spinner-border text-danger"></div>
        <p class="mt-3 text-muted">Loading combo details...</p>
    </div>
</ng-template>

<!-- =============================
     WRAP WHOLE PAGE WITH *ngIf
================================ -->
<div *ngIf="perfume; else loading" class="container mt-4 perfume-detail-container">

    <!-- ðŸ”™ Back Button -->
    <div class="mb-3">
        <button class="btn btn-outline-danger" (click)="goBack()">
            <i style="color:black" class="bi bi-arrow-left"></i> Back
        </button>
    </div>

    <!-- ðŸ” Image Zoom Modal -->
    <div class="image-modal" [class.show]="isImageZoomed" (click)="closeZoom()">
        <img
            [src]="perfume.imageurl"
            class="zoomed-image"
            (click)="$event.stopPropagation()"
        />
    </div>

    <!-- ðŸŸ£ Toast Notification -->
    <div class="cart-toast" [class.show]="showToast">
        <div class="cart-toast-box">
            <ng-container *ngIf="toastMessage === 'Please login before adding items to cart.'; else successMsg">
                <div>
                  !{{ toastMessage }}
                </div>
            </ng-container>

            <ng-template #successMsg>
              <i class="bi bi-check-circle-fill text-success me-2"></i>
              {{ toastMessage }}
            </ng-template>
        </div>
    </div>

    <!-- Main Product Section -->
    <div class="row align-items-center">
        <div class="col-md-5 text-center">
            <img
                [src]="perfume.imageurl"
                alt="{{ perfume.name }}"
                class="img-fluid rounded shadow main-image"
                (click)="openZoom()"
            />
        </div>

        <div class="col-md-7">
            <h2>{{ perfume.name }}</h2>
            <p class="text-muted">{{ perfume.description }}</p>

            <!-- â­ Rating -->
            <div *ngIf="rating" class="mb-3">
                <span class="text-warning">
                  <i *ngFor="let star of [].constructor(rating)" class="bi bi-star-fill"></i>
                  <i *ngFor="let star of [].constructor(5 - rating)" class="bi bi-star"></i>
                </span>
                <small class="text-muted ms-2">{{ rating }} / 5</small>
            </div>

            <h4 class="text-dark fw-bold">â‚¹{{ perfume.price | number: '1.2-2' }}</h4>
            <p><strong>Gender:</strong> {{ perfume.gender | titlecase }}</p>

            <button class="btn btn-royal mt-3" (click)="addToCart(perfume)">Add to Cart</button>
        </div>
    </div>

     <!-- You may also like -->
     <div class="mt-5 relevant-items">
        <h4 class="mb-4 text-center">You may also like</h4>

        <div class="row g-4 justify-content-center">
            <div
                class="col-md-3 col-sm-6 col-6"
                *ngFor="let p of relatedPerfumes"
                (click)="goToPerfume(p.id)"
                style="cursor:pointer;">

                <div class="mb-4 card shadow-sm perfume-card">
                    <img
                        [src]="p.imageurl"
                        alt="{{ p.name }}"
                        class="card-img-top perfume-image"
                    />
                    <div class="card-body text-center">
                        <h6 class="card-title">{{ p.name }}</h6>
                        <p class="text-muted mb-0">â‚¹{{ p.price | number:'1.2-2' }}</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
