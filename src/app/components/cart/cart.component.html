<!-- Toast Message -->
<div class="toast-container" *ngIf="showToast">
  <div class="custom-toast">
    {{ toastMessage }}
  </div>
</div>

<div class="container mt-4 pt-5 mb-5">

  <!-- Clear Cart -->
  <div class="d-flex justify-content-end">
    <button
      *ngIf="cartItems.length > 0"
      class="btn btn-danger clear-cart-btn mb-4"
      data-bs-toggle="modal"
      data-bs-target="#clearCartModal"
    >
      <i class="bi bi-trash me-1"></i> Clear Cart
    </button>
  </div>

  <!-- Empty Cart Messages -->
  <div *ngIf="cartItems.length === 0 && storedUserId">
    <h2 class="text-center">Your Cart is empty ðŸ˜¢</h2>
  </div>

  <div *ngIf="cartItems.length === 0 && !storedUserId">
    <h5 class="text-center">You need to login/sign-up to add items in cart</h5>
  </div>

  <!-- CART CONTENT -->
  <div class="row" *ngIf="cartItems.length > 0">

    <!-- LEFT SIDE: ITEMS LIST -->
    <div class="col-md-8">
      <div class="cart-row" *ngFor="let item of cartItems">

        <img [src]="item.imageUrl" alt="{{ item.name }}" class="cart-img">

        <div class="cart-info">
          <h5>{{ item.name }}</h5>
          <p class="text-muted">{{ item.description }}</p>
          <p><strong>Gender:</strong> {{ item.gender }}</p>

          <div class="qty-controls">
            <button (click)="updateQuantity(item, item.quantity - 1)">âˆ’</button>
            <span>{{ item.quantity }}</span>
            <button (click)="updateQuantity(item, item.quantity + 1)">+</button>
          </div>

          <p class="price">â‚¹{{ (item.price * item.quantity) | number: '1.2-2' }}</p>

          <button class="btn btn-outline-danger btn-sm mt-2 remove-btn"
            (click)="removeItem(item.cartId)">
            Remove
          </button>
        </div>

      </div>
    </div>

    <!-- RIGHT SIDE SUMMARY -->
    <div class="col-md-4">
      <div class="summary-box glass-summary fade-in">

        <h4 class="summary-title">Order Summary</h4>
        <hr>

        <div class="coupon-box">
          <input type="text" class="form-control coupon-input"
                 placeholder="Enter Coupon Code"
                 [(ngModel)]="couponCode">

                <div class="coupon-suggestion mt-3"
             (click)="discount > 0 ? removeCoupon() : applySuggestedCoupon()">

          <div class="left">
            <div class="coupon-title">
              Use Code: <strong>FIRST10</strong>
            </div>
            <div class="coupon-desc">
              Flat 10% OFF â€¢ Valid for all users
            </div>
          </div>

          <div class="right">
            <button class="apply-btn-small"
                    [ngClass]="discount > 0 ? 'remove-btn' : ''">
              {{ discount > 0 ? 'Remove' : 'Apply' }}
            </button>
          </div>
        </div>

          <p class="text-success mt-2" *ngIf="discount > 0">
            ðŸŽ‰ Coupon Applied! You saved â‚¹{{ discount | number:'1.0-0' }}
          </p>

          <p class="text-danger mt-2" *ngIf="couponError">
            {{ couponError }}
          </p>
        </div>

        <table class="table summary-table mt-3">
          <thead>
            <tr>
              <th>Item</th>
              <th>Qty</th>
              <th>Total</th>
            </tr>
          </thead>

          <tbody>
            <tr *ngFor="let item of cartItems">
              <td>{{ item.name }}</td>
              <td>x{{ item.quantity }}</td>
              <td>â‚¹{{ (item.price * item.quantity) | number:'1.0-0' }}</td>
            </tr>
          </tbody>

          <tfoot>
            <tr>
              <th colspan="2">Delivery Fee</th>
              <th>Free</th>
            </tr>

            <tr class="final-total-row">
              <th colspan="2">Grand Total</th>
              <th class="final-total">â‚¹{{ total | number:'1.0-0' }}</th>
            </tr>
          </tfoot>
        </table>

        <button class="btn btn-success w-100 mt-3 pay-now-btn">
          Checkout
        </button>

      </div>
    </div>
  </div>
</div>



<!-- ======================= MODAL =========================== -->
<div class="modal fade" id="clearCartModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">

      <div class="modal-header">
        <h5 class="modal-title">Clear Cart?</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <div class="modal-body">
        Are you sure you want to clear the entire cart?
      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>

        <button class="btn btn-danger" (click)="confirmClearCart()" data-bs-dismiss="modal">
          Yes, Clear All
        </button>
      </div>

    </div>
  </div>
</div>
